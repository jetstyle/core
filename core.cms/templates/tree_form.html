<!--<h1 class="cms-content-title-">Разделы сайта</h1>-->
{{!connect 'colorbox.js'}}
{{!connect 'colorbox.css'}}
{{!connect 'mysplitter.js'}}

{{:buggy}}
<!--
{{!connect 'jstree/jquery.cookie.js'}}
{{!connect 'splitter.js'}}
<div class="splitter">
	<div class="tree-" style="font-size: 80%">
    <div class="cms-list-advanced">
        <div class="toolbar" >
            {{@blocks/help_link.html}}
            {{__trash_switch}}
            {{__add_new}}
        </div>
    </div>
    {{@blocks/submenu.html}}
    {{wrapped.0}} 
	</div>
	<div>
    <div class="carpet" style="position: absolute; display: none; background: transparent;"></div>
    <div class="statusbarview" style="position: fixed; width: 100%">
        {{@blocks/b_breadcrumbs.html cms="true"}}
    </div>
    {{wrapped.1}}
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
            var newH = parseInt($(".splitter").height())-$(".splitter").position().top;

            $(".splitter").css("height", newH );
            $(".splitter").splitter({minLeft: 300, minRight: 300, sizeLeft: 300, onStartSplit: function(){

                $(".carpet").each( function (){
                        $(this).css({
				width: $(this).parent().width(),
				height: $(this).parent().height(),
                                "z-index": 10000,
			}).show();
                })}, 
                
                onEndSplit: function(){
                    $(".carpet").hide();
                },
                cookie: "splitter"
            
            });
            

                $(".submenu- li:not(.current-)").hover(function(){
                    $(this).css("background-color", "#E3E9FF");
                }, function(){
                    $(this).css("background-color", "#FFFFFF");
                });
                
                
                $(".new-element-").click( function(){
                    $(".new-element-menu-").toggleClass("invisible");
                });
        });
</script>
-->
{{/:buggy}}


<table cellspacing="0" class="w100 cms-body">
  <thead><tr>
    <td></td>
    <td class="cms-body_tools">
      {{@blocks/help_link.html}}
      {{__trash_switch}}
      {{__add_new}}
    </td>
    <td class="cms-body_sep"></td>
    <td>{{module_title}}</td>
  </tr></thead>
  <tbody><tr>
    <td></td>
    <td class="cms-body_tree" id="table1">
      <div class="carpet" style="position: absolute; display: none; background: transparent;"></div>
      {{wrapped.0}}
    </td>
    <td id="separator" class="cms-body_sep"></td>
    <td width="85%" style="padding-left: 20px; padding-top: 12px" id="table3">
      <div class="carpet" style="position: absolute; display: none; background: transparent;"></div>
      {{wrapped.1}}
    </td>
  </tr></tbody>
</table>

<script type="text/javascript">
  var startpos, diffpos=0;
  var permitted = false;
  
  var startLeft  = parseInt( $("#table1").css("width") );
  var startRight = parseInt( $("#table3").css("width") );
        
	$(document).ready(function(){
    $('#separator').mousedown(function(e){
        startpos = e.clientX + diffpos;
        permitted = true;
    }).attr("unselectable", "on").hover(
      function(){
        /*$('.cms-body_sep').css('background-color', '#E4E6E1');*/
        $('.cms-body_sep').css('background-color', '#ccc');
      }, 
      function(){
        /*$('.cms-body_sep').css('background-color', '#E3E9FF');*/
        
        $('.cms-body_sep').css('background-color', '#e4e6e1');
        /*$('.cms-body_sep').css('background-color', '#F0F2ED');*/
    }).dblclick(            
      function(){
        if ( $(this).prev('td:hidden').length > 0 ){
          $(this).prev('td').show();
          $(this).next('td').attr('width', '85%');
        }
        else {
          $(this).prev('td').hide();
          $(this).next('td').attr('width', '99%');
        }
    });
    
    $("body").mousemove(function(e){
      if (permitted) {
        $("body").focus();
    
        new_position = e.clientX;
        diffpos = startpos-new_position;

        $("#table1").css({"-webkit-user-select": "none", "width": startLeft - diffpos} );
        /*$("#separator").css("width", 6);*/
        $("#table3").css("width", startRight + diffpos );
        
        $(".carpet").each( function (){
          $(this).css({
            width: $(this).parent().width(),
            height: $(this).parent().height(),
            "z-index": 10000,
          }).show();
        });
      }
    }).mouseup(function(e){
      permitted = false;
      $(".carpet").hide();
      
      e.preventDefault();
    });

    /*if( $("#update_2").position().left > $(".quick-simple-form").position().left+$(".quick-simple-form").width() )
    {
        $("#update_2").css({"float": "", "position": "absolute", "left": ($(".quick-simple-form").position().left+$(".quick-simple-form").width()) });
    };*/
	});
</script>
